<!DOCTYPE html>
<html>
<head>
    <title>My Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- jsPsych ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <!-- jsPsych ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <!-- í•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ë“¤ ë¡œë“œ -->
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
    <!-- jsPsych ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    <!-- ëª¨ë°”ì¼ ìµœì í™” ìŠ¤íƒ€ì¼ -->
    <style>
        /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
        @media (max-width: 768px) {
            body {
                font-size: 18px !important;
            }
            
            .jspsych-content {
                font-size: 16px !important;
                line-height: 1.6 !important;
            }
            
            h4 {
                font-size: 20px !important;
            }
            
            /* ë…¸ë€ìƒ‰ ìê·¹ì–´ í¬ê¸° ì¡°ì • */
            span[style*="background-color: #ffeb3b"] {
                font-size: 28px !important;
            }
            
            /* ëŒ€í™” ë‚´ìš© í¬ê¸° ì¡°ì • */
            div[style*="font-family: monospace"] {
                font-size: 16px !important;
            }
            
            /* ëª¨ë°”ì¼ í™•ëŒ€ ë°©ì§€ - ì—¬ê¸°ì— ì¶”ê°€ */
            input, textarea, select {
                font-size: 16px !important;
                zoom: 1;
                -webkit-appearance: none;
                border-radius: 0;
            }
            
            body {
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
                zoom: 1;
            }
            
            .jspsych-content-wrapper {
                zoom: 1;
                -webkit-text-size-adjust: 100%;
            }
        }
    </style>
</head>
<body></body>
<script>

    // jsPsych ì´ˆê¸°í™”
    var jsPsych = initJsPsych({
        on_trial_start: function() {
        // ê° trial ì‹œì‘ ì‹œ í˜ì´ì§€ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
        window.scrollTo(0, 0);
        document.body.scrollTop = 0; // Safariìš©
        document.documentElement.scrollTop = 0; // Chrome, Firefox ë“±
    },
        on_finish: function() {
        // ì˜¬ë°”ë¥¸ ë°ì´í„° ì ‘ê·¼ ë°©ì‹
        var allData = jsPsych.data.get().values();
        console.log('ì „ì²´ ë°ì´í„°:', allData);
        
        // ê¸°ë³¸ ì •ë³´ ë°ì´í„° ì°¾ê¸°
        var basicInfo = null;
        var rtResults = [];
        
        for (var i = 0; i < allData.length; i++) {
            console.log('ë°ì´í„° ' + i + ':', allData[i]);
            
            if (allData[i].trial_type === 'survey-text') {
                if (!allData[i].task_type) {
                    // ê¸°ë³¸ ì •ë³´ ë¬¸í•­ (task_typeì´ ì—†ëŠ” survey-text)
                    basicInfo = allData[i].response;
                    console.log('ê¸°ë³¸ ì •ë³´ ë°œê²¬:', basicInfo);
                }
            }
            
            if (allData[i].task_type === 'conversation_reaction_time') {
                // ë°˜ì‘ì‹œê°„ ë¬¸í•­
                rtResults.push(allData[i]);
                console.log('ë°˜ì‘ì‹œê°„ ë¬¸í•­ ë°œê²¬:', allData[i]);
            }
        }
        
        console.log('ìµœì¢… ê¸°ë³¸ ì •ë³´:', basicInfo);
        console.log('ìµœì¢… ë°˜ì‘ì‹œê°„ ê²°ê³¼:', rtResults);
        
        // ë°ì´í„°ê°€ ì œëŒ€ë¡œ ìˆëŠ”ì§€ í™•ì¸
        if (!basicInfo) {
            console.log('ê¸°ë³¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>ë°ì´í„° ì˜¤ë¥˜!</h2></div>';
            return;
        }
        
        // ì „ì†¡í•  ë°ì´í„° êµ¬ì„±
        var submitData = {
            age: basicInfo.age || '',
            sex: basicInfo.sex || '',
            school_department: basicInfo.school_department || '',
            growth_location: basicInfo.growth_location || '',
            parents_region: basicInfo.parents_region || ''
        };
        
        // ë°˜ì‘ì‹œê°„ ë°ì´í„° ì¶”ê°€
        var scenarioOrder = ['ìœ íŠœë²„ ë§Œë‚¨', 'ì‰í”„ ë§Œë‚¨', 'ê²°í˜¼ì‹', 'íŒ¬ ì‚¬ì¸íšŒ', 'ê³ ì–‘ì´ ì…ì–‘'];
        var sortedRtResults = [];
        
        for (var k = 0; k < scenarioOrder.length; k++) {
            for (var m = 0; m < rtResults.length; m++) {
                if (rtResults[m].scenario === scenarioOrder[k]) {
                    sortedRtResults.push(rtResults[m]);
                    break;
                }
            }
        }
        
        // ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ ë°ì´í„° ì¶”ê°€
        for (var j = 0; j < sortedRtResults.length && j < 5; j++) {
            var responseKey = Object.keys(sortedRtResults[j].response)[0];
            submitData['rt_q' + (j+1) + '_response'] = sortedRtResults[j].response[responseKey] || '';
            submitData['rt_q' + (j+1) + '_rt'] = sortedRtResults[j].first_key_rt || '';
            submitData['rt_q' + (j+1) + '_scenario'] = sortedRtResults[j].scenario || '';
        }
        
        console.log('ì „ì†¡í•  ë°ì´í„°:', submitData);
        
        var scriptURL = 'https://script.google.com/macros/s/AKfycby8S_WhuthXrVQUCATPJZrhbLaLq1XnIygsuRsu1ickSN4NgmV-O0K7RySaxhKStojD/exec';
        
        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(submitData)
        }).then(response => {
            document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>ì œì¶œ ì™„ë£Œ!</h2></div>';
        }).catch(error => {
            console.log('ì „ì†¡ ì˜¤ë¥˜:', error);
            document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>ì œì¶œ ì™„ë£Œ!</h2></div>';
        });
    }
    });
    // ì‹¤í—˜ ìˆœì„œë¥¼ ë‹´ì„ ë°°ì—´
    var timeline = [];

    // 1. í™˜ì˜ ë©”ì‹œì§€
    var welcome = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <h2>ì„¤ë¬¸ì¡°ì‚¬ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!</h2>
            <p>ì´ ì„¤ë¬¸ì€ ë‹¤ì„¯ ë¬¸í•­ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆê³  ì•½ 2ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
        `,
        choices: ['ì‹œì‘í•˜ê¸°']
    };
    // 2. ì¼ë°˜ í…ìŠ¤íŠ¸ ì§ˆë¬¸ë“¤
    var basic_questions = {
        type: jsPsychSurveyText,
        questions: [
            {
                prompt: '(ë§Œ) ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìˆ«ìë§Œ ì…ë ¥)', 
                name: 'age',
                required: true
            },
            {
                prompt: 'ì„±ë³„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ë‚¨/ì—¬)', 
                name: 'sex',
                required: true
            },
            {
                prompt: 'í˜„ì¬ ì¬í•™ ì¤‘ì¸ í•™êµì™€ í•™ê³¼ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”(ì—†ìœ¼ë©´ "ì—†ìŒ"ìœ¼ë¡œ ì…ë ¥):', 
                name: 'school_department',
                required: true
            },
            {
                prompt: 'ì£¼ ì„±ì¥ ì§€ì—­(í•™ì°½ ì‹œì ˆì„ ì˜¤ë˜ ë³´ë‚¸ ì§€ì—­)ì€ ì–´ë””ì…ë‹ˆê¹Œ?:', 
                name: 'growth_location',
                required: true
            },
            {
                prompt: 'ë¶€ëª¨ë‹˜ì˜ ì£¼ ì„±ì¥ ì§€ì—­(í•™ì°½ ì‹œì ˆì„ ì˜¤ë˜ ë³´ë‚¸ ì§€ì—­)ì€ ì–´ë””ì…ë‹ˆê¹Œ?:', 
                name: 'parents_region',
                required: true
            }
        ],
        preamble: '<h3>ê¸°ë³¸ ì •ë³´</h3>'
    };

    // ì „ì—­ ë³€ìˆ˜ (ê° ë¬¸í•­ìš©)
    var rtData = {};

    // ë°˜ì‘ì‹œê°„ ì¸¡ì • í•¨ìˆ˜ (ê³µí†µ)
    function createRTQuestion(prompt_content, response_name, scenario_name, question_number) {
        return {
            type: jsPsychSurveyText,
            questions: [
                {
                    prompt: prompt_content,
                    name: response_name,
                    required: true
                }
            ],
            data: {
                task_type: 'conversation_reaction_time',
                scenario: scenario_name,
                question_number: question_number
            },
            on_load: function() {
                var questionStartTime = performance.now();
                var firstKeyPressed = false;
                rtData[question_number] = null;
                
                console.log('ë¬¸í•­ ' + question_number + ' (' + scenario_name + ') ë¡œë“œë¨');
                
                setTimeout(function() {
                    var inputField = document.querySelector('input[type="text"]');
                    console.log('ì…ë ¥ í•„ë“œ ì°¾ê¸° ê²°ê³¼:', inputField ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
                    
                    if (inputField) {
                        console.log('âœ… ' + scenario_name + ' ë°˜ì‘ì‹œê°„ ì¸¡ì • ì¤€ë¹„ ì™„ë£Œ');
                        
                        inputField.addEventListener('input', function(e) {
                            console.log('ì…ë ¥ ì´ë²¤íŠ¸ ë°œìƒ:', e.target.value);
                            
                            if (!firstKeyPressed) {
                                rtData[question_number] = Math.round(performance.now() - questionStartTime);
                                firstKeyPressed = true;
                                console.log('ğŸ¯ ' + scenario_name + ' ì²« í‚¤ ì…ë ¥ ë°˜ì‘ì‹œê°„: ' + rtData[question_number] + 'ms');
                            }
                        });
                        
                        inputField.focus();
                        
                    } else {
                        console.log('âŒ ' + scenario_name + ' ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                }, 1000);
            },
            on_finish: function(data) {
                if (rtData[question_number] !== null) {
                    data.first_key_rt = rtData[question_number];
                    console.log('âœ… ' + scenario_name + ' ë°˜ì‘ì‹œê°„ ë°ì´í„° ì €ì¥: ' + rtData[question_number] + 'ms');
                } else {
                    console.log('âŒ ' + scenario_name + ' ë°˜ì‘ì‹œê°„ ì¸¡ì • ì‹¤íŒ¨ - ë°ì´í„°ê°€ null');
                }
            }
        };
    }

    // 3. ëŒ€í™” ìƒí™© ë°˜ì‘ì‹œê°„ ì¸¡ì • ë¬¸í•­ë“¤
    var conversation_rt_question = createRTQuestion(
        `<div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.6;">
<h4 style="margin-top: 0; color: #333;">ë‹¤ìŒ ëŒ€í™”ë¥¼ ì½ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì ì ˆí•œ ë§ì„ ì…ë ¥í•˜ì„¸ìš”:</h4>

<div style="background-color: white; padding: 15px; border-left: 4px solid #4CAF50; margin: 15px 0;">
<strong>ìƒí™©:</strong> Aê°€ ê¸¸ì„ ê°€ë‹¤ê°€ ìœ íŠœë¸Œ í¬ë¦¬ì—ì´í„° Bë¥¼ ë§Œë‚œ ìƒí™©
</div>

<div style="font-family: monospace; background-color: white; padding: 15px; border: 1px solid #ddd;">
<div style="margin-bottom: 8px;"><strong>A:</strong> ì–´!! ì•ˆë…•í•˜ì„¸ìš”. ì € ì˜ìƒ ë´¤ì–´ìš”!</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì•ˆë…•í•˜ì„¸ìš”~ ì •ë§ìš”??</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> ë„¤!!</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ê°ì‚¬í•©ë‹ˆë‹¤~ ì œ ì˜ìƒ ì–´ë–»ê²Œ ë³´ì…¨ì–´ìš”?</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> <span style="background-color: #ffeb3b; padding: 2px 5px;">__________</span> ë´¤ì–´ìš”!</div>
</div>


</div>`,
        'conversation_response_0',
        'ìœ íŠœë²„ ë§Œë‚¨',
        1
    );

    var conversation_rt_question_1 = createRTQuestion(
        `<div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.6;">
<h4 style="margin-top: 0; color: #333;">ë‹¤ìŒ ëŒ€í™”ë¥¼ ì½ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì ì ˆí•œ ë§ì„ ì…ë ¥í•˜ì„¸ìš”:</h4>

<div style="background-color: white; padding: 15px; border-left: 4px solid #FF9800; margin: 15px 0;">
<strong>ìƒí™©:</strong> Aê°€ ê¸¸ì„ ê°€ë‹¤ê°€ ìœ ëª… ì‰í”„ Bë¥¼ ë§Œë‚œ ìƒí™©
</div>

<div style="font-family: monospace; background-color: white; padding: 15px; border: 1px solid #ddd;">
<div style="margin-bottom: 8px;"><strong>A:</strong> ì–´? í˜¹ì‹œ... B ì‰í”„ë‹˜ì´ì„¸ìš”?</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì•„, ë„¤ ë§ìŠµë‹ˆë‹¤.</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> ì§€ë‚œë²ˆì— ì‰í”„ ë‹˜ ì‹ë‹¹ì—ì„œ ì‹ì‚¬í–ˆì–´ìš”!!</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì•„, ì •ë§ìš”? ê°ì‚¬í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ ë“œì…¨ì–´ìš”?</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> <span style="background-color: #ffeb3b; padding: 2px 5px;">__________</span> ë¨¹ì—ˆì–´ìš”!</div>
</div>


</div>`,
        'conversation_response_1',
        'ì‰í”„ ë§Œë‚¨',
        2
    );

    var conversation_rt_question_2 = createRTQuestion(
        `<div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.6;">
<h4 style="margin-top: 0; color: #333;">ë‹¤ìŒ ëŒ€í™”ë¥¼ ì½ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì ì ˆí•œ ë§ì„ ì…ë ¥í•˜ì„¸ìš”:</h4>

<div style="background-color: white; padding: 15px; border-left: 4px solid #E91E63; margin: 15px 0;">
<strong>ìƒí™©:</strong> ì‹ ë¶€ Bì˜ ê²°í˜¼ì‹ì¥ì—ì„œ
</div>

<div style="font-family: monospace; background-color: white; padding: 15px; border: 1px solid #ddd;">
<div style="margin-bottom: 8px;"><strong>A:</strong> ì˜¤ëœë§Œì´ì•¼. ê²°í˜¼ ì¶•í•˜í•´.</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì–´? A? ì •ë§ ì˜¤ëœë§Œì´ë‹¤! ì–´ë–»ê²Œ ì™”ì–´!</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> <span style="background-color: #ffeb3b; padding: 2px 5px;">__________</span> ì™”ì§€.</div>
</div>


</div>`,
        'conversation_response_2',
        'ê²°í˜¼ì‹',
        3
    );

    var conversation_rt_question_3 = createRTQuestion(
        `<div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.6;">
<h4 style="margin-top: 0; color: #333;">ë‹¤ìŒ ëŒ€í™”ë¥¼ ì½ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì ì ˆí•œ ë§ì„ ì…ë ¥í•˜ì„¸ìš”:</h4>

<div style="background-color: white; padding: 15px; border-left: 4px solid #9C27B0; margin: 15px 0;">
<strong>ìƒí™©:</strong> ë…ì Aê°€ íŒ¬ ì‚¬ì¸íšŒ ìë¦¬ì—ì„œ ì‘ê°€ Bë¥¼ ë§Œë‚œ ìƒí™©
</div>

<div style="font-family: monospace; background-color: white; padding: 15px; border: 1px solid #ddd;">
<div style="margin-bottom: 8px;"><strong>A:</strong> ì•ˆë…•í•˜ì„¸ìš”! ì •ë§ ëµ™ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ë„¤, ë°˜ê°‘ìŠµë‹ˆë‹¤ Aë‹˜. ì œ ì±…ì„ ì–´ë–»ê²Œ ì½ìœ¼ì…¨ë‚˜ìš”?</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> <span style="background-color: #ffeb3b; padding: 2px 5px;">__________</span> ì½ì—ˆì–´ìš”!</div>
</div>


</div>`,
        'conversation_response_3',
        'íŒ¬ ì‚¬ì¸íšŒ',
        4
    );

    var conversation_rt_question_4 = createRTQuestion(
        `<div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.6;">
<h4 style="margin-top: 0; color: #333;">ë‹¤ìŒ ëŒ€í™”ë¥¼ ì½ê³  ë¹ˆì¹¸ì— ë“¤ì–´ê°ˆ ì ì ˆí•œ ë§ì„ ì…ë ¥í•˜ì„¸ìš”:</h4>

<div style="background-color: white; padding: 15px; border-left: 4px solid #4CAF50; margin: 15px 0;">
<strong>ìƒí™©:</strong> ê³ ì–‘ì´ì— ëŒ€í•œ ëŒ€í™”
</div>

<div style="font-family: monospace; background-color: white; padding: 15px; border: 1px solid #ddd;">
<div style="margin-bottom: 8px;"><strong>A:</strong> ë„ˆ ê³ ì–‘ì´ ìœ ê¸°ë¬˜ ì„¼í„°ì—ì„œ ë°ë ¤ì™”ì§€?</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì‘. ê±°ê¸°ì„œ ì²˜ìŒ ë°ë ¤ì˜¬ ë•Œ ê³ ìƒí–ˆì–´.</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> ì™œ ê³ ìƒí•´?</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> ì•ˆ ì˜¤ë ¤ê³  í•´ì„œ.</div>
<div style="margin-bottom: 8px;"><strong>A:</strong> ê·¸ëŸ¼ ì–´ë–»ê²Œ ë°ë ¤ì™”ì–´?</div>
<div style="margin-bottom: 8px;"><strong>B:</strong> <span style="background-color: #ffeb3b; padding: 2px 5px;">__________</span> ë°ë ¤ì™”ì§€.</div>
</div>


</div>`,
        'conversation_response_4',
        'ê³ ì–‘ì´ ì…ì–‘',
        5
    );

    // ì‹¤í—˜ ìˆœì„œ ì„¤ì •
    // ìœ íŠœë²„ ë§Œë‚¨ ë¬¸í•­ì€ ê³ ì •, ë‚˜ë¨¸ì§€ë§Œ ëœë¤
    var fixed_first_question = conversation_rt_question;  // ìœ íŠœë²„ ë§Œë‚¨ (ê³ ì •)

    var random_questions = [
        conversation_rt_question_1,   // ì‰í”„ ë§Œë‚¨  
        conversation_rt_question_2,   // ê²°í˜¼ì‹
        conversation_rt_question_3,   // íŒ¬ ì‚¬ì¸íšŒ
        conversation_rt_question_4    // ê³ ì–‘ì´ ì…ì–‘
    ];

    // ë‚˜ë¨¸ì§€ 4ê°œë§Œ ëœë¤í•˜ê²Œ ì„ê¸°
    random_questions = jsPsych.randomization.shuffle(random_questions);

    // ì‹¤í—˜ ìˆœì„œ ì„¤ì •
    timeline.push(welcome);
    timeline.push(basic_questions);
    timeline.push(fixed_first_question);  // ìœ íŠœë²„ ë§Œë‚¨ í•­ìƒ ì²« ë²ˆì§¸

    // ë‚˜ë¨¸ì§€ ëœë¤ ìˆœì„œë¡œ ì¶”ê°€
    for (var i = 0; i < random_questions.length; i++) {
        timeline.push(random_questions[i]);
    }


    // ì‹¤í—˜ ì‹œì‘!
    jsPsych.run(timeline);

</script>

</html>







